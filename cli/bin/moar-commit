#!/bin/bash

set -e

if [ "$1" == "" ] || [ "$2" == "" ]; then
  echo 'Required'
  echo '$1 -- RegEx Filter'
  echo '$2 -- Message'
  exit 1
fi

filter=$1

mkdir -p ~/moar-workspace

for module in ~/moar-workspace/*; do

    cd ${module}
    name="$(basename ${module})"

    if [[ ${name} =~ $filter ]]; then
        status="$(git status --short 2> /dev/null | wc -l | sed 's/ //g' || true)"
        if [ "$status" != "0" ]; then
            echo $(basename ${module})
            git add -A || true
            git commit -m "$2" | grep 'files changed' || true
        fi
    fi

done